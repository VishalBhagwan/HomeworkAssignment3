@model HomeworkAssignment3.Models.HomeViewModel
@{
    ViewBag.Title = "Home";
    int staffTotalPages = (int)Math.Ceiling((double)Model.TotalStaff / 1);
    int customerTotalPages = (int)Math.Ceiling((double)Model.TotalCustomers / 1);
    int productTotalPages = (int)Math.Ceiling((double)Model.TotalProducts / 1);
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<div class="container mt-4">
    <h2 class="text-center mb-4">🏠 BikeStores Dashboard</h2>

    <div class="row">
        <!-- Staff -->
        <div class="col-md-4">
            <div class="card p-3">
                <h4>
                    👥 Staff
                    <button class="btn btn-primary btn-sm float-end" data-bs-toggle="modal" data-bs-target="#createStaffModal">
                        Create
                    </button>
                </h4>
                @if (Model.StaffList.Any())
                {
                    var s = Model.StaffList.First();
                    <div class="mb-2"><label>First Name</label><input class="form-control" value="@s.first_name" readonly /></div>
                    <div class="mb-2"><label>Last Name</label><input class="form-control" value="@s.last_name" readonly /></div>
                    <div class="mb-2"><label>Staff ID</label><input class="form-control" value="@s.staff_id" readonly /></div>
                    <div class="mb-2"><label>Email</label><input class="form-control" value="@s.email" readonly /></div>
                    <div class="mb-2"><label>Phone</label><input class="form-control" value="@s.phone" readonly /></div>
                    <div class="mb-2"><label>Active</label><input class="form-control" value="@(s.active == 1 ? "Yes" : "No")" readonly /></div>
                    <div class="mb-2"><label>Store</label><input class="form-control" value="@(s.store?.store_name)" readonly /></div>

                    <!-- Paging -->
                    <div class="d-flex justify-content-center">
                        <nav>
                            <ul class="pagination pagination-sm">
                                <li class="page-item @(Model.StaffPage == 1 ? "disabled" : "")">
                                    <a class="page-link" href="@Url.Action("Index", new {
                                        staffPage = Model.StaffPage - 1,
                                        customerPage = Model.CustomerPage,
                                        productPage = Model.ProductPage,
                                        brandFilter = Model.SelectedBrand,
                                        categoryFilter = Model.SelectedCategory
                                    })">&lt;</a>
                                </li>
                                <li class="page-item disabled"><a class="page-link">@Model.StaffPage / @staffTotalPages</a></li>
                                <li class="page-item @(Model.StaffPage >= staffTotalPages ? "disabled" : "")">
                                    <a class="page-link" href="@Url.Action("Index", new {
                                        staffPage = Model.StaffPage + 1,
                                        customerPage = Model.CustomerPage,
                                        productPage = Model.ProductPage,
                                        brandFilter = Model.SelectedBrand,
                                        categoryFilter = Model.SelectedCategory
                                    })">&gt;</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                }
            </div>
        </div>

        <!-- Customers -->
        <div class="col-md-4">
            <div class="card p-3">
                <h4>
                    👨‍💼 Customers
                    <button class="btn btn-success btn-sm float-end" data-bs-toggle="modal" data-bs-target="#createCustomerModal">
                        Create
                    </button>
                </h4>
                @if (Model.CustomerList.Any())
                {
                    var c = Model.CustomerList.First();
                    <div class="mb-2"><label>First Name</label><input class="form-control" value="@c.first_name" readonly /></div>
                    <div class="mb-2"><label>Last Name</label><input class="form-control" value="@c.last_name" readonly /></div>
                    <div class="mb-2"><label>Customer ID</label><input class="form-control" value="@c.customer_id" readonly /></div>
                    <div class="mb-2"><label>Email</label><input class="form-control" value="@c.email" readonly /></div>
                    <div class="mb-2"><label>Phone</label><input class="form-control" value="@c.phone" readonly /></div>
                    <div class="mb-2"><label>Street</label><input class="form-control" value="@c.street" readonly /></div>
                    <div class="mb-2"><label>City</label><input class="form-control" value="@c.city" readonly /></div>
                    <div class="mb-2"><label>State</label><input class="form-control" value="@c.state" readonly /></div>
                    <div class="mb-2"><label>Zip Code</label><input class="form-control" value="@c.zip_code" readonly /></div>

                    <!-- Paging -->
                    <div class="d-flex justify-content-center">
                        <nav>
                            <ul class="pagination pagination-sm">
                                <li class="page-item @(Model.CustomerPage == 1 ? "disabled" : "")">
                                    <a class="page-link" href="@Url.Action("Index", new {
                                        staffPage = Model.StaffPage,
                                        customerPage = Model.CustomerPage - 1,
                                        productPage = Model.ProductPage,
                                        brandFilter = Model.SelectedBrand,
                                        categoryFilter = Model.SelectedCategory
                                    })">&lt;</a>
                                </li>
                                <li class="page-item disabled"><a class="page-link">@Model.CustomerPage / @customerTotalPages</a></li>
                                <li class="page-item @(Model.CustomerPage >= customerTotalPages ? "disabled" : "")">
                                    <a class="page-link" href="@Url.Action("Index", new {
                                        staffPage = Model.StaffPage,
                                        customerPage = Model.CustomerPage + 1,
                                        productPage = Model.ProductPage,
                                        brandFilter = Model.SelectedBrand,
                                        categoryFilter = Model.SelectedCategory
                                    })">&gt;</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                }
            </div>
        </div>

        <!-- Products -->
        <div class="col-md-4">
            <div class="card p-3">
                <h4>
                    🚴 Products
                </h4>
                <form method="get" id="filterForm">
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <select name="brandFilter" class="form-select">
                                <option value="">All Brands</option>
                                @foreach (var b in Model.Brands)
                                {
                                    <option value="@b" @(Model.SelectedBrand == b ? "selected" : "")>@b</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-6">
                            <select name="categoryFilter" class="form-select">
                                <option value="">All Categories</option>
                                @foreach (var c in Model.Categories)
                                {
                                    <option value="@c" @(Model.SelectedCategory == c ? "selected" : "")>@c</option>
                                }
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-outline-primary btn-sm w-100">Apply Filters</button>
                </form>

                <div class="border p-2 mt-2" style="background:#f9f9f9;">
                    @if (Model.ProductList.Any())
                    {
                        var p = Model.ProductList.First();
                        <div class="mb-2"><label>Product Name</label><input class="form-control" value="@p.product_name" readonly /></div>
                        <div class="mb-2"><label>Brand</label><input class="form-control" value="@p.brand.brand_name" readonly /></div>
                        <div class="mb-2"><label>Category</label><input class="form-control" value="@p.category.category_name" readonly /></div>
                        <div class="mb-2"><label>Model Year</label><input class="form-control" value="@p.model_year" readonly /></div>
                        <div class="mb-2"><label>Price</label><input class="form-control" value="R @p.list_price" readonly /></div>
                        <div class="text-center">
                            @{
                                // Get the image for this product
                                string imagePath = Model.ProductImages.ContainsKey(p.product_id)
                                    ? Model.ProductImages[p.product_id]
                                    : "~/Content/Bikes-Images/bike1.jpg"; 
                            }
                            <img src="@Url.Content(imagePath)" class="img-fluid border rounded" style="max-height: 150px; object-fit: cover;"
                                 alt="@p.product_name"
                                 onerror="this.src='@Url.Content("~/Content/Bikes-Images/bike1.jpg")'" />
                        </div>

                        <!-- Paging -->
                        <div class="d-flex justify-content-center mt-2">
                            <nav>
                                <ul class="pagination pagination-sm">
                                    <li class="page-item @(Model.ProductPage == 1 ? "disabled" : "")">
                                        <a class="page-link" href="@Url.Action("Index", new {
                                            staffPage = Model.StaffPage,
                                            customerPage = Model.CustomerPage,
                                            productPage = Model.ProductPage - 1,
                                            brandFilter = Model.SelectedBrand,
                                            categoryFilter = Model.SelectedCategory
                                        })">&lt;</a>
                                    </li>
                                    <li class="page-item disabled"><a class="page-link">@Model.ProductPage / @productTotalPages</a></li>
                                    <li class="page-item @(Model.ProductPage >= productTotalPages ? "disabled" : "")">
                                        <a class="page-link" href="@Url.Action("Index", new {
                                            staffPage = Model.StaffPage,
                                            customerPage = Model.CustomerPage,
                                            productPage = Model.ProductPage + 1,
                                            brandFilter = Model.SelectedBrand,
                                            categoryFilter = Model.SelectedCategory
                                        })">&gt;</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    }
                    else
                    {
                        <div class="text-center text-muted">
                            No products found with selected filters.
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<!-- Create staff modal -->
<div class="modal fade" id="createStaffModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Create New Staff Member</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            @using (Html.BeginForm("Create", "staffs", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">First Name</label>
                                <input type="text" class="form-control" name="first_name" required />
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">Last Name</label>
                                <input type="text" class="form-control" name="last_name" required />
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">Email</label>
                                <input type="email" class="form-control" name="email" required />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">Phone</label>
                                <input type="text" class="form-control" name="phone" />
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">Active</label>
                                <select class="form-select" name="active" required>
                                    <option value="1">Yes</option>
                                    <option value="0">No</option>
                                </select>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">Store</label>
                                <select class="form-select" name="store_id" required>
                                    <option value="">Select Store</option>
                                    @foreach (var store in ViewBag.Stores as SelectList ?? new SelectList(new List<string>()))
                                    {
                                        <option value="@store.Value">@store.Text</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Staff</button>
                </div>
            }
        </div>
    </div>
</div>

<!-- Create customer modal -->
<div class="modal fade" id="createCustomerModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Create New Customer</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            @using (Html.BeginForm("Create", "customers", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">First Name</label>
                                <input type="text" class="form-control" name="first_name" required />
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">Last Name</label>
                                <input type="text" class="form-control" name="last_name" required />
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">Email</label>
                                <input type="email" class="form-control" name="email" />
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">Phone</label>
                                <input type="text" class="form-control" name="phone" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">Street</label>
                                <input type="text" class="form-control" name="street" />
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">City</label>
                                <input type="text" class="form-control" name="city" />
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">State</label>
                                <input type="text" class="form-control" name="state" />
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">Zip Code</label>
                                <input type="text" class="form-control" name="zip_code" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Create Customer</button>
                </div>
            }
        </div>
    </div>
</div>

<script>
    // Initialize modals and handle form submissions
    document.addEventListener('DOMContentLoaded', function () {
        // Clear form when modal is closed
        var modals = document.querySelectorAll('.modal');
        modals.forEach(function (modal) {
            modal.addEventListener('hidden.bs.modal', function () {
                var forms = this.querySelectorAll('form');
                forms.forEach(function (form) {
                    form.reset();
                });
            });
        });

        var priceFields = document.querySelectorAll('input[name="list_price"]');
        priceFields.forEach(function (field) {
            field.addEventListener('blur', function () {
                var value = this.value;
                if (value && !isNaN(parseFloat(value))) {
                    this.value = parseFloat(value).toFixed(2);
                }
            });
        });
    });
</script>